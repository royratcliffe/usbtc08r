<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>USB 8-Channel Thermocouple for R • usbtc08r</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="USB 8-Channel Thermocouple for R">
<meta property="og:description" content="What the package does (one paragraph).">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">usbtc08r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="usb-8-channel-thermocouple-for-r-usbtc08r-package">USB 8-Channel Thermocouple for R (<code>usbtc08r</code> Package)<a class="anchor" aria-label="anchor" href="#usb-8-channel-thermocouple-for-r-usbtc08r-package"></a>
</h1></div>
<!-- badges: start -->
<p>The goal of the R package <code>usbtc08r</code> is to provide the thinnest amount of software wrapping between R and the Pico Technology TC-08 via C++. The package acts as a thin shimming layer. While it provides access for R to the underlying vendor interface with suitable mapping between C types and R types, the package also adds higher-level functions that operate using the vendor interface, e.g. synchronous and non-synchronous initialisation.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>usbtc08r</code> as follows, starting with <code>devtools</code> if not already installed:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"royratcliffe/usbtc08r"</span>, <span class="st">"main"</span><span class="op">)</span></span></code></pre></div>
<p>Before installation can succeed, you first need to install Pico Technology’s <code>libusbtc08</code> driver library. Install the PicoSDK on Windows, or macOS, but install using Aptitude as the package <code>libusbtc08-dev</code> on Linux. The build process needs access to the driver’s header files and shared library; hence the <code>dev</code> package for the headers.</p>
<div class="section level3">
<h3 id="rtools-on-windows">Rtools on Windows<a class="anchor" aria-label="anchor" href="#rtools-on-windows"></a>
</h3>
<p>You need <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link">Rtools</a> to build the package on Windows. The package includes C++, so needs the compiler toolchain. Check for package build problems using the <code>pkgbuild</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pkgbuild</span><span class="fu">::</span><span class="fu">check_build_tools</span><span class="op">(</span>debug <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Connect one or more Pico TC-08 devices to your computer and initialise using the exemplar code listed below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">usbtc08r</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/usb_tc08_open_async.html">usb_tc08_open_async</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tc08</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/usb_tc08_open_async_complete.html">usb_tc08_open_async_complete</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>unit <span class="op">=</span> <span class="va">tc08</span>, channel <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>, <span class="fl">1L</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="reference/usb_tc08_set_channel.html">usb_tc08_set_channel</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">unit</span>, <span class="va">x</span><span class="op">$</span><span class="va">channel</span>, <span class="st">"K"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">tc08</span>, <span class="va">usb_tc08_run</span>, <span class="fl">1000L</span><span class="op">)</span></span></code></pre></div>
<p>This snippet opens all attached TC-08 devices, one or more, for asynchronous temperature sampling. Opening starts and opening itself runs asynchronously until complete. The result is a list of device unit handles. The snippet expands the list by channel for channels one through eight and applies a channel set request to each unit channel for K-type thermocouple and enables each one. Finally, it runs each unit with a 1,000-millisecond sampling interval or one sample continuously for all enabled channels every second.</p>
<p>The Pico Technology eight-channel thermocouple in asynchronous mode outputs time-stamped temperatures in buffered blocks. Buffered blocks of timed temperatures comprise an ordered list of time-temperature pairs. Time stamps have millisecond dimensions relative to the start of the asynchronous sampling process. The thermocouple instrument continuously samples its channels internally, filling an internal buffer until the connected host reads the buffer over USB.</p>
<p>Once set up, a task needs to periodically read the channels along the following lines.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unit.chan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>unit <span class="op">=</span> <span class="va">tc08</span>, channel <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="kw">repeat</span> <span class="op">{</span></span>
<span>  <span class="va">time.temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Filter</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0L</span>, <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">unit.chan</span>, <span class="fl">1L</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">length</span>, <span class="va">...</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="reference/usb_tc08_get_temp_deskew.html">usb_tc08_get_temp_deskew</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">unit</span>, <span class="va">length</span>, <span class="va">x</span><span class="op">$</span><span class="va">channel</span>, <span class="va">...</span><span class="op">)</span>,</span>
<span>      <span class="fl">10L</span>, <span class="st">"centigrade"</span>, <span class="cn">FALSE</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">time.temps</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"pico:tc08:%d:%d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"handle"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"channel"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1L</span>, <span class="kw">function</span><span class="op">(</span><span class="va">row</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">key</span>, <span class="va">row</span><span class="op">[</span><span class="st">"time"</span><span class="op">]</span>, <span class="va">row</span><span class="op">[</span><span class="st">"temp"</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0L</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This example calls <code>usb_tc08_get_temp_deskew</code> but the interface also makes equivalent <code>usb_tc08_get_temp</code> available. Both functions read the temperature buffers. The repeat loop applies “get temp” to the unit channel grid, thereby running once for each unit-channel permutation. Channels have indices 0 through 8 inclusive. The calls ask for 10 samples at a time in Centigrade units. The result is a list of time-temperature data frames. The snippet filters out empty frames. The second half of the repeat loop outputs the times and temperatures by row for each non-empty data frame; else sleeps for 100 milliseconds if all empty. The sleep idles the task for a short while but only if nothing at all reads from any attached device. Call this a greedy approach: crunch until nothing left to eat.</p>
</div>
<div class="section level2">
<h2 id="unit-behaviour-synchronous-and-asynchronous">Unit Behaviour, Synchronous and Asynchronous<a class="anchor" aria-label="anchor" href="#unit-behaviour-synchronous-and-asynchronous"></a>
</h2>
<p>Each unit comprises nine channels. Strictly speaking, using Unified Modelling nomenclature, units <em>compose</em> of channels; the lifetime of the channel strictly depends on its unit. Units “have” channels, the <a href="https://www.uml-diagrams.org/composition.html" class="external-link">stronger form of aggregation</a>.</p>
<p>Units have two modes of operation: synchronous and asynchronous. The difference between these modes extends beyond the driver threading model. A unit itself switches mode accordingly and precludes behaviours from the non-operating mode. Specifically, asking for a single sample set fails when running asynchronously. Software experimentation quickly discovers this limitation, or feature, which impacts driver acquisition design.</p>
<p>Asynchronous mode switches the unit into a more advanced form of temperature data collection where the Pico Technology firmware records time-stamped temperature readings for all its enabled channels. By implication, therefore, channel set-up always precedes acquisition; nor can set-up interlace with asynchronous running. Switching thermocouple types requires a shutdown and re-start.</p>
</div>
<div class="section level2">
<h2 id="trapping-errors">Trapping errors<a class="anchor" aria-label="anchor" href="#trapping-errors"></a>
</h2>
<p>The R functions wrap ‘error trapping’ by performing two important sub-duties:</p>
<ol style="list-style-type: decimal">
<li>detect errors by testing return values and thereby discern non-error values and their meaning;</li>
<li>translate error codes to R exceptions thereby making it easier to plot execution paths in client-level user code.</li>
</ol>
<p>Generally speaking, the driver interface functions have <em>signed</em> 16-bit integer return values returning positive values on success, and negative on failure.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Useful links are below.</p>
<ul>
<li>
<a href="https://www.picotech.com/data-logger/tc-08/thermocouple-data-logger" class="external-link">TC-08 thermocouple data logger</a>, manufacturer’s page</li>
<li><a href="https://www.picotech.com/downloads/linux" class="external-link">Linux Software &amp; Drivers for Oscilloscopes and Data Loggers</a></li>
<li>
<a href="https://github.com/picotech" class="external-link">Pico Technology at GitHub</a>, Pico Technology GitHub organisation</li>
<li>
<a href="https://github.com/picotech/picosdk-c-examples/tree/master/usbtc08" class="external-link">Pico SDK C examples at GitHub</a>, manufacturer’s C examples</li>
<li>
<a href="https://github.com/picotech/picosdk-usbtc08-matlab-examples" class="external-link">USB TC-08 Thermocouple Data Logger MATLAB Examples</a>, manufacturer’s MATLAB examples</li>
<li>
<a href="https://reposcope.com/package/libusbtc08-1" class="external-link">libusbtc08-1—Hardware interface library for PicoTech USB TC08 Thermocouple sensor</a>, Linux repositories inspector</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing usbtc08r</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Roy Ratcliffe <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-6594-1280" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://CRAN.R-project.org/package=usbtc08r" class="external-link"><img src="https://www.r-pkg.org/badges/version/usbtc08r" alt="CRAN status"></a></li>
<li><a href="https://github.com/royratcliffe/usbtc08r/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/royratcliffe/usbtc08r/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Roy Ratcliffe.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
